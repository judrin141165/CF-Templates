
---
AWSTemplateFormatVersion: "2010-09-09"
Description: Create Stack
Parameters:
  NameOfService:
    Description: Tagname assosiated with this stack
    Type: String
  KeyName:
    Description: Name of existing SSH keypair
    Type: AWS::EC2::KeyPair::KeyName

  DBClass:
    Description: DB instance class
    Type: String
    Default: db.t1.micro



Resources:
  S3Bucket:
     Type: 'AWS::S3::Bucket'
     Properties:

        BucketName: judrinbucket
        BucketEncryption:
          ServerSideEncryptionConfiguration:
            - ServerSideEncryptionByDefault:
                SSEAlgorithm: 'aws:kms'
                KMSMasterKeyID: KMS-KEY-ARN
        AccessControl: PublicRead
        WebsiteConfiguration:
          IndexDocument: index.html
          ErrorDocument: error.html
        Tags:
          - Key: name
            Value: !Ref NameOfService
  EC2Instance:
     Type: 'AWS::EC2::Instance'
     Properties:
        InstanceType: t2.micro
        ImageId: ami-077e31c4939f6a2f3
        InstanceInitiatedShutdownBehavior: stop
        Tags:
          - Key: Name
            Value: !Ref NameOfService
        KeyName: !Ref KeyName
        SecurityGroups:
           - default
  DBInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      DBInstanceClass: !Ref DBClass


  ElasticIp:
    Type: AWS::EC2::EIP
    Properties:
      InstanceId: !Ref EC2Instance


















Outputs:
  WebsiteURL:
    Value: !GetAtt
      - S3Bucket
      - WebsiteURL
  PublicIPinstance:
    Value: !GetAtt
      - EC2Instance
      - PublicIp











